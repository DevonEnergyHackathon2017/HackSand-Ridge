function ProcessTableRefresh(n,t){for(rt in _RefreshTables)if(n!=undefined&&n||t!=undefined&&t)n?postMessage({tableName:_RefreshTables[rt].name,extra:_RefreshTables[rt].extra,offline:!0}):postMessage({tableName:_RefreshTables[rt].name,extra:_RefreshTables[rt].extra,revalidate:!0});else if(_RefreshTables[rt].action)switch(_RefreshTables[rt].action.toLowerCase()){case"post":SDDataWorker.Post({table:_RefreshTables[rt].name,data:_RefreshTables[rt].data?_RefreshTables[rt].data:null,callbackID:{tableName:_RefreshTables[rt].name,extra:_RefreshTables[rt].extra},callback:function(n){if(n&&n.err&&n.err.legnth>0)for(e in n.err)postMessage(n.err[e]);n.responseData&&(n.callbackID.responseData=n.responseData);postMessage(n.callbackID)}});break;case"get":SDDataWorker.Get({table:_RefreshTables[rt].name,data:_RefreshTables[rt].data?_RefreshTables[rt].data:null,callbackID:{tableName:_RefreshTables[rt].name,extra:_RefreshTables[rt].extra},returnArr:_RefreshTables[rt].returnArr?_RefreshTables[rt].returnArr:!1,callback:function(n){if(n&&n.err){postMessage(n.err);return}postMessage({tableName:n.callbackID.tableName,extra:n.callbackID.extra,dataArr:n&&n.dataArr?n.dataArr:null,responseData:n.responseData?n.responseData:null})}})}}function RefreshData(){SDDataWorker.CheckServerConnection(function(n){SDDataWorker.IsOnline(n)?_RefreshTables.length>0&&ProcessTableRefresh():_RefreshTables.length>0&&ProcessTableRefresh(SDDataWorker.IsOffline(n),SDDataWorker.Revalidate(n))})}function CompleteInit(n){postMessage({event:n.dataReadyListener});n.refresh&&n.refresh.interval&&n.refresh.interval>0&&(n.refresh.refreshTables&&(_RefreshTables=n.refresh.refreshTables),setInterval(RefreshData,n.refresh.interval),RefreshData())}importScripts("sd.dataworker.js");var SDDataWorker=new SD.DataWorker,_RefreshTables=[];onmessage=function(n){try{var t=n.data;t.init?t.init.database&&t.init.database.name?SDDataWorker.OpenDB({dbName:t.init.database.name,onlineURL:t.init.onlineURL,onlineTimeout:t.init.onlineTimeout,validationURL:t.init.validationURL,shim:t.init.shim?t.init.shim:!1,dbTables:t.init.database.tables,success:function(){CompleteInit(t.init)},error:function(){postMessage({err:this.error})}}):(SDDataWorker.Init({onlineURL:t.init.onlineURL,onlineTimeout:t.init.onlineTimeout,validationURL:t.init.validationURL,dbTables:t.init.database&&t.init.database.tables?t.init.database.tables:null}),CompleteInit(t.init)):t.tableName?SDDataWorker.CheckServerConnection(function(n){SDDataWorker.IsOnline(n)?t.action&&t.action.toLowerCase()=="post"?SDDataWorker.Post({table:t.tableName,data:t.data?t.data:null,callbackID:{tableName:t.tableName,extra:t.extra},callback:function(n){if(n&&n.err&&n.err.legnth>0)for(e in n.err)postMessage(n.err[e]);n.responseData&&(n.callbackID.responseData=n.responseData);postMessage(n.callbackID)}}):SDDataWorker.Get({table:t.tableName,data:t.data?t.data:null,callbackID:{tableName:t.tableName,extra:t.extra},returnArr:t.returnArr?t.returnArr:!1,callback:function(n){if(n&&n.err){postMessage(n.err);return}postMessage({tableName:n.callbackID.tableName,extra:n.callbackID.extra,dataArr:n&&n.dataArr?n.dataArr:null,responseData:n.responseData?n.responseData:null})}}):SDDataWorker.Revalidate(n)?postMessage({tableName:t.tableName,revalidate:!0,extra:t.extra}):postMessage({tableName:t.tableName,offline:!0,extra:t.extra})}):t.online!=undefined&&SDDataWorker.SetOnline(t.online)}catch(e){postMessage({err:e?e.stack?e.stack:e:"undefined error"})}};onerror=function(n){postMessage({err:"internal error occurred: "+n})};